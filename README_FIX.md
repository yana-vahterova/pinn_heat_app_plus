# PINN & FDM: fixes and consistency updates (2025‑09‑11)

## Что сделано
1. **Жёсткое задание нулевых НУ/ГУ в PINN**  
   Добавлен автоматический режим: если *все* заданные условия (`ic`, `ict` — для гиперболических моделей, `left_bc`, `right_bc`) равны нулю, то в обучении включается **output transform** и соответствующие слагаемые лосса **отключаются** (их веса становятся 0).  
   Для остальных случаев условия учитываются в функции потерь (как раньше).  
   - Реализовано в `app.py` (авто‑детектор) и используется класс `TransformedPINN` из `src/pinn_model.py`.
   - Флажок в сайдбаре: *“Hard‑enforce zero IC/BC when they are zero”*.

2. **Пояснения к жёсткому заданию НУ/ГУ**
   В `TransformedPINN` применяется преобразование вывода `u = S(x)*T(t)*NN(x,t)` с
   - `S(x) = (ξ^2)(1−ξ)^2` — обнуляет **u** и **u_x** на границах, корректно работая для нулевых **Дирихле/Неймана**;
   - `T(t) = τ` (Фурье) или `τ^2` (гиперболические модели) — обнуляет **u** (и **u_t** для гиперболических) при `t=t_min`.

3. **Численные методы (FDM)**
   - Проверена корректность подсчёта правых частей для схем **Backward Euler / Crank–Nicolson** с учётом **времезависимых** ДУ/НУ: добавления `(±g/dx)` (Нейман) и `(u_B/dx^2)` (Дирихле) выполнены консистентно.
   - Гарантирована установка граничных узлов на каждом шаге (для явной FTCS и в пост‑процессе для BE/CN).  
   - Добавлен тест `tests/sanity_fourier_cn.py`: сравнение с аналитическим решением `u=exp(-κπ²t)sin(πx)`; ожидаемая погрешность уменьшается при измельчении сетки.

4. **Экспорт конфигурации**
   - Включён ключ `use_output_transform_zero_only` в `src/config_io.py` для экспорта/импорта настроек.

## Как запускать
```bash
# Тест FDM против аналитики
python -m pinn_heat_app_plus.tests.sanity_fourier_cn
```
Если используете пакетно: `python pinn_heat_app_plus/tests/sanity_fourier_cn.py`.

## Примечания
- Для **ненулевых** граничных/начальных условий PINN автоматически возвращается к учёту условий через лосс.  
- Для гиперболических моделей при «жёстком нуле» также зануляется **скорость** в момент `t=t_min`.

